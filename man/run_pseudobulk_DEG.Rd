% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pseudobulk_deg.R
\name{run_pseudobulk_DEG}
\alias{run_pseudobulk_DEG}
\title{Run pseudo-bulk differential expression analysis with biological replicates}
\usage{
run_pseudobulk_DEG(
  seuObj,
  cellTypeCol = "cellType",
  sampleCol = "sampleID",
  conditionCol = "condition",
  controlGroup = "WT",
  testGroup = NULL,
  cellTypes = NULL,
  minCells = 10,
  minSamples = 2,
  assayName = "RNA",
  slot = "counts",
  lowExprFilter = FALSE,
  padjThreshold = 0.05,
  lfcThreshold = 0,
  verbose = TRUE
)
}
\arguments{
\item{seuObj}{A Seurat object containing single-cell RNA-seq data}

\item{cellTypeCol}{Character string specifying the column name in metadata
that contains cell type annotations (default: "CellType")}

\item{sampleCol}{Character string specifying the column name in metadata
that contains sample IDs (default: "sampleID")}

\item{conditionCol}{Character string specifying the column name in metadata
that contains condition/group information. If NULL, will be automatically
extracted from sampleCol by removing numeric suffixes (default: NULL)}

\item{controlGroup}{Character string specifying the reference/control group
name (e.g., "WT", "CTRL"). This will be used as the baseline for comparison}

\item{testGroup}{Character string specifying the test/treatment group name
(e.g., "CKO", "KO"). If NULL, all non-control groups will be compared}

\item{cellTypes}{Character vector of specific cell types to analyze. If NULL,
all cell types will be analyzed (default: NULL)}

\item{minCells}{Integer, minimum number of cells required per sample for a
cell type to be included in analysis (default: 10)}

\item{minSamples}{Integer, minimum number of samples required per condition
for analysis (default: 2)}

\item{assayName}{Character string specifying which assay to use (default: "RNA")}

\item{slot}{Character string specifying which slot to use. Must be "counts"
for proper DESeq2 analysis (default: "counts")}

\item{padjThreshold}{Numeric, adjusted p-value threshold for significance
(default: 0.05)}

\item{lfcThreshold}{Numeric, log2 fold change threshold for significance
(default: 0)}

\item{verbose}{Logical, whether to print progress messages (default: TRUE)}
}
\value{
A list containing:
\describe{
\item{results}{A dataframe with differential expression results for all
cell types, containing columns:
\itemize{
\item cellType: Cell type name
\item gene: Gene symbol
\item baseMean: Mean of normalized counts across all samples
\item log2FoldChange: Log2 fold change (test vs control)
\item lfcSE: Standard error of log2FoldChange
\item stat: Wald test statistic
\item pvalue: Unadjusted p-value
\item padj: Benjamini-Hochberg adjusted p-value
\item significant: Logical indicating if gene meets significance criteria
\item regulation: "UP" or "DOWN" for significant genes
}}
\item{summary}{A dataframe summarizing the number of DEGs per cell type}
\item{dds_objects}{A list of DESeq2 dataset objects for each cell type
(useful for downstream analyses like variance stabilization)}
\item{pseudobulk_counts}{Aggregated count matrix used for analysis}
\item{sample_metadata}{Metadata table describing samples and conditions}
\item{parameters}{List of parameters used in the analysis}
}
}
\description{
Performs pseudo-bulk differential gene expression analysis for single-cell
RNA-seq data with biological replicates. This function aggregates single-cell
data to pseudo-bulk samples and uses DESeq2 for statistical testing, which
properly accounts for biological variability between replicates.
}
\details{
This function implements the pseudo-bulk approach for differential expression
analysis of single-cell RNA-seq data with biological replicates. The key steps are:

\enumerate{
\item Aggregate single-cell counts to pseudo-bulk samples by combining cells
from the same cell type and sample
\item Create sample metadata linking each pseudo-bulk sample to its condition
\item For each cell type, run DESeq2 analysis accounting for biological replicates
\item Filter and annotate results based on significance thresholds
}

This approach is superior to standard FindMarkers for experiments with biological
replicates because:
\itemize{
\item It properly treats biological replicates as the unit of replication
\item It avoids pseudo-replication issues (treating cells as independent)
\item It uses appropriate statistical models (negative binomial) for count data
\item It provides accurate p-values and controls false discovery rates
}
}
\note{
\itemize{
\item Requires DESeq2 package to be installed
\item Input must be raw counts (not normalized or log-transformed)
\item Recommended to have at least 3 biological replicates per condition
\item Cell types with too few cells or samples will be automatically excluded
}
}
\examples{
\dontrun{
# Basic usage with automatic condition detection
results <- run_pseudobulk_DEG(
  seuObj = seurat_obj,
  cellTypeCol = "CellType",
  sampleCol = "sampleID",
  controlGroup = "WT"
)

# Analyze specific cell types only
results <- run_pseudobulk_DEG(
  seuObj = seurat_obj,
  cellTypeCol = "CellType",
  sampleCol = "sampleID",
  controlGroup = "WT",
  testGroup = "CKO",
  cellTypes = c("T_cells", "B_cells", "Macrophages")
)

# Access results
deg_table <- results$results
summary_stats <- results$summary

# Get significant genes for a specific cell type
tcell_degs <- subset(results$results,
                     cellType == "T_cells" & significant == TRUE)
}

}
\references{
Love, M.I., Huber, W., Anders, S. (2014) Moderated estimation of fold change
and dispersion for RNA-seq data with DESeq2. Genome Biology, 15:550.

Squair, J.W. et al. (2021) Confronting false discoveries in single-cell
differential expression. Nature Communications, 12:5692.
}
